trigger:
- main

pool:
  vmImage: ubuntu-latest

steps:
# 1. Trigger the OIDC handshake to get the token
# Ensure 'MyServiceConnection' is configured as an OIDC connection in Project Settings
- task: JfrogCliV2@1
  name: jfStep
  inputs:
    jfrogPlatformConnection: 'MyServiceConnection'
    command: 'jf rt ping' # Minimal command to exchange the OIDC token

# 2. Use curl to download the file using the Bearer token
- script: |
    echo "Attempting to download hi.sh using OIDC token..."
    
    # Target URL from your request
    FILE_URL="https://hts2.jfrog.io/artifactory/sharanya-oidc/hi.sh"
    
    # Use the token exported by the jfStep task
    # Note: $(jfStep.oidc_token) is the variable provided by the JFrog extension
    curl -H "Authorization: Bearer $(jfStep.oidc_token)" \
         -L "$FILE_URL" \
         --output hi.sh
         
    echo "Download complete."
  displayName: 'Download File with Curl (OIDC)'

# 3. Optional: Verify the downloaded file
- script: |
    ls -l hi.sh
    cat hi.sh
  displayName: 'Verify Content'