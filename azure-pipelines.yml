trigger:
- main

pool:
  vmImage: ubuntu-latest

steps:
# 1. Perform the OIDC handshake to get the $(jfStep.oidc_token)
- task: JfrogCliV2@1
  name: jfStep
  inputs:
    jfrogPlatformConnection: 'MyServiceConnection'
    command: 'jf rt ping'

# 2. Use the OIDC token to download the file via curl
- script: |
    echo "Starting download for hi.sh..."
    
    # Using the token from the previous step
    curl -H "Authorization: Bearer $(jfStep.oidc_token)" \
         -L "https://hts2.jfrog.io/artifactory/sharanya-oidc/hi.sh" \
         --output hi.sh
         
    echo "Download complete."
  displayName: 'Download hi.sh via Curl'

# 3. Verify the file and its contents
- script: |
    if [ -f hi.sh ]; then
      echo "File hi.sh exists. Printing content:"
      cat hi.sh
      # Make it executable if you need to run it later
      chmod +x hi.sh
    else
      echo "Error: hi.sh was not downloaded."
      exit 1
    fi
  displayName: 'Verify and Read File'